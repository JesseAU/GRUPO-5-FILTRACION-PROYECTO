name: "CI - ValidaciÃ³n de funcionalidad"

on:
  push:
    branches:
      - main
      - "logica-filtro(JS)"
  pull_request:
    branches:
      - main
      - "logica-filtro(JS)"

jobs:
  validate:
    runs-on: ubuntu-latest

    steps:
      - name: "ğŸ“¥ Clonar repositorio"
        uses: actions/checkout@v3

      - name: "âš™ï¸ Instalar dependencias"
        run: |
          npm init -y
          npm install --save-dev eslint@8 htmlhint stylelint stylelint-config-standard

      - name: "ğŸ“ Crear configuraciÃ³n ESLint"
        run: |
          echo '{
            "env": {
              "browser": true,
              "es2021": true
            },
            "extends": "eslint:recommended",
            "parserOptions": {
              "ecmaVersion": 12
            },
            "rules": {}
          }' > .eslintrc.json

      - name: "ğŸ“ Crear configuraciÃ³n Stylelint"
        run: |
          echo '{
            "extends": "stylelint-config-standard"
          }' > .stylelintrc.json

      - name: "ğŸ“ Crear configuraciÃ³n Htmlhint"
        run: |
          echo '{"htmlhint": {"tagname-lowercase": true, "attr-lowercase": true}}' > .htmlhintrc

      # Validar HTML solo en main
      - name: "âœ… Validar HTML"
        if: github.ref == 'refs/heads/main'
        run: npx htmlhint "**/*.html"

      # Validar CSS solo en main
      - name: "ğŸ¨ Validar CSS"
        if: github.ref == 'refs/heads/main'
        run: npx stylelint "**/*.css"

      # Validar JS
      - name: "ğŸ› ï¸ Validar JavaScript"
        run: |
          if [ "${GITHUB_REF##*/}" = "logica-filtro(JS)" ]; then
            echo "ğŸ” Validando solo script.js..."
            npx eslint "script.js"
          else
            echo "ğŸ” Validando todos los archivos JS..."
            npx eslint "script.js"
          fi

      - name: "ğŸ‰ Todo correcto"
        if: ${{ success() }}
        run: echo "âœ… ValidaciÃ³n completada correctamente."

      - name: "ğŸš¨ Error encontrado"
        if: ${{ failure() }}
        run: echo "âŒ Se encontraron errores en la validaciÃ³n."
